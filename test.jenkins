@Library('tenable.common') _


import com.tenable.jenkins.*
import com.tenable.jenkins.builds.*
import com.tenable.jenkins.ui.*
import com.tenable.jenkins.builds.nexusiq.*
import com.tenable.jenkins.common.*
import com.tenable.jenkins.deployments.*

BuildParams bparams = new BuildParams(this, 1000)

GeneralBuild general = new GeneralBuild(this, bparams)
BuildsCommon buildsCommon = new BuildsCommon(this)

node(Constants.DOCKERNODE) {
    buildsCommon.cleanup()
    checkout scm

    sh 'cat .git/config'

    buildsCommon.prepareGit()
    buildsCommon.prepareGitRepo()

    sh "echo 0.0.0 > FULLVERSION"

    stash name: 'FULLVERSION', includes: 'FULLVERSION'

    String theTag = "APP1000_0.0.0"

    sshagent([Constants.BITBUCKETUSER]) {
        echo 'Running tag for: ' + theTag

        sh "ssh-keyscan -H  github.com >> ~/.ssh/known_hosts"

        echo sh(script:"git tag -m '${theTag}' ${theTag}", returnStdout:true)
        echo sh(script:"git push origin --tags ${theTag}", returnStdout:true)
    }
}
